<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ğŸ›°ï¸</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ø± */
        .source-card {
            border: none;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.4s ease;
            opacity: 0.4; /* Ø¨Ø§Ù‡Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            filter: grayscale(100%); /* Ø±Ù…Ø§Ø¯ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            transform: scale(0.95);
            box-shadow: none;
            background: #e9ecef;
            color: #6c757d;
        }

        .source-card i { font-size: 2.5rem; margin-bottom: 10px; }
        .source-card h5 { font-weight: bold; font-size: 1rem; margin: 0; }

        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ†Ø´ÙŠØ· (Active States) */
        .source-card.active {
            opacity: 1;
            filter: grayscale(0%);
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            color: white;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ†Ø´ÙŠØ· */
        .active-gps { background: linear-gradient(135deg, #28a745, #218838); } /* Ø£Ø®Ø¶Ø± */
        .active-wifi { background: linear-gradient(135deg, #007bff, #0056b3); } /* Ø£Ø²Ø±Ù‚ */
        .active-tower { background: linear-gradient(135deg, #fd7e14, #d35400); } /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */

        /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #map { height: 55vh; width: 100%; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 2px solid white; }

        /* ØªÙØ§ØµÙŠÙ„ Ø³ÙÙ„ÙŠØ© */
        .info-badge {
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 10px;
            font-weight: bold;
            color: #343a40;
        }
        .info-badge i { margin-left: 8px; }
    </style>
</head>
<body>

<div class="container py-3">
    <h3 class="text-center mb-4 fw-bold text-dark"><i class="fas fa-location-dot text-danger"></i> Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</h3>

    <div class="row g-3 mb-4">
        <div class="col-4">
            <div id="card-gps" class="source-card">
                <i class="fas fa-satellite"></i>
                <h5>GPS</h5>
                <small>Ø£Ù‚Ù…Ø§Ø± ØµÙ†Ø§Ø¹ÙŠØ©</small>
            </div>
        </div>
        
        <div class="col-4">
            <div id="card-wifi" class="source-card">
                <i class="fas fa-wifi"></i>
                <h5>WiFi</h5>
                <small>Ø±Ø§ÙˆØªØ± Ù…Ù†Ø²Ù„ÙŠ</small>
            </div>
        </div>

        <div class="col-4">
            <div id="card-tower" class="source-card">
                <i class="fas fa-broadcast-tower"></i>
                <h5>Tower</h5>
                <small>Ø£Ø¨Ø±Ø§Ø¬ Ø§ØªØµØ§Ù„</small>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-12">
            <div id="map"></div>
        </div>
    </div>

    <div class="row text-center">
        <div class="col-6">
            <div class="info-badge text-primary">
                <i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø³Ø±Ø¹Ø©: <span id="speedVal">0</span> ÙƒÙ…/Ø³
            </div>
        </div>
        <div class="col-6">
            <div class="info-badge text-danger">
                <i class="fas fa-crosshairs"></i> Ø§Ù„Ø¯Ù‚Ø©: <span id="accVal">--</span> Ù…ØªØ±
            </div>
        </div>
        <div class="col-12">
            <div class="info-badge text-secondary">
                <i class="far fa-clock"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastTime">--:--:--</span>
            </div>
        </div>
    </div>

    <div class="d-grid gap-2 mt-2">
        <a id="googleBtn" href="#" target="_blank" class="btn btn-dark btn-lg rounded-pill shadow">
            <i class="fab fa-google"></i> ÙØªØ­ ÙÙŠ Google Maps
        </a>
    </div>

</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // ğŸ›‘ğŸ›‘ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ ğŸ›‘ğŸ›‘
    const firebaseURL = "https://gps-tracker-534ae-default-rtdb.firebaseio.com/gps.json";

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    var map = L.map('map').setView([33.3152, 44.3661], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    var carIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/741/741407.png', // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø³ÙŠØ§Ø±Ø© Ø¬Ù…ÙŠÙ„Ø©
        iconSize: [40, 40],
        iconAnchor: [20, 20],
    });

    var marker = L.marker([0, 0], {icon: carIcon}).addTo(map);
    var circle = L.circle([0, 0], {radius: 0}).addTo(map);

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function updateUI(type) {
        // 1. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø§Ù‡Øª
        document.getElementById('card-gps').className = "source-card";
        document.getElementById('card-wifi').className = "source-card";
        document.getElementById('card-tower').className = "source-card";

        // 2. ØªÙ†Ø´ÙŠØ· Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        if (type.includes("GPS")) {
            document.getElementById('card-gps').classList.add("active", "active-gps");
            circle.setStyle({color: 'green', fillColor: '#28a745'});
        } 
        else if (type.includes("WiFi")) {
            document.getElementById('card-wifi').classList.add("active", "active-wifi");
            circle.setStyle({color: 'blue', fillColor: '#007bff'});
        } 
        else {
            document.getElementById('card-tower').classList.add("active", "active-tower");
            circle.setStyle({color: 'orange', fillColor: '#fd7e14'});
        }
    }

    function fetchData() {
        fetch(firebaseURL)
            .then(res => res.json())
            .then(data => {
                if (data && data.lat && data.lng) {
                    var lat = parseFloat(data.lat);
                    var lng = parseFloat(data.lng);
                    var acc = data.accuracy || 0;
                    var type = data.type || "Unknown";
                    var speed = Math.round(data.speed || 0);

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                    var pos = new L.LatLng(lat, lng);
                    marker.setLatLng(pos);
                    circle.setLatLng(pos);
                    circle.setRadius(acc);
                    map.setView(pos);

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ù†ØµÙˆØµ
                    document.getElementById('speedVal').innerText = speed;
                    document.getElementById('accVal').innerText = acc;
                    document.getElementById('lastTime').innerText = new Date().toLocaleTimeString();
                    document.getElementById('googleBtn').href = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;

                    // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ù„ÙˆØ¬ÙŠÙƒ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                    updateUI(type);
                }
            })
            .catch(err => console.error(err));
    }

    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
    setInterval(fetchData, 3000);
    fetchData();

</script>

</body>
</html>
